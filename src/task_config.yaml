analysis_task:
  description: >
    1. Load the dataset at {dataset_path} and perform mandatory preprocessing (cleaning, type conversion).
    2. Analyze the data based on the user query: "{user_query}".
    3. **Memory Check:** If this is a revised run, review previous feedback and adjust the analysis focus accordingly.
    4. OUTPUT REQUIREMENT: Provide a structured summary for the Manager containing:
       - SECTION A: Key Statistical Insights (Logic, Metrics, KPIs).
       - SECTION B: Plotting Data (Aggregated numbers and suggestions for 2-3 plots).
  expected_output: >
    A structured technical summary with Section A (Stats) and Section B (Plot Data), ready for the Manager to review and the Visualizer to use.

visualization_task:
  description: >
    1. Review 'SECTION B' from the Analyst's output to understand the data structure.
    2. **Style Retrieval (Mandatory):** Identify the type of chart needed (e.g., 'line', 'bar'). 
       **Call the `StyleConfigTool`** with this chart type to get the dictionary of styling parameters (palette, figure_size, spines, etc.).
    3. **Code Generation:** Generate Python code to create the plots. 
       **Constraint:** You must unpack/inject the parameters retrieved from Step 2 into your plotting functions (e.g., `sns.barplot(..., **retrieved_params)`). 
       Do NOT hardcode colors unless explicitly overriding for a specific insight.
    4. **Save Images:** Save plots strictly to `{result_path}/{dataset_name}/images/`.
    5. **Memory Check:** If previous feedback mentioned style issues, ensure you are correctly applying the tool's output this time.
  expected_output: >
    A list of relative paths for the saved images (formatted: 'IMAGE_PATH: images/filename.png') 
    where every image strictly adheres to the company style retrieved from the tool.
    Accompanied by a short visual trend analysis for each plot.

report_task:
  description: >
    1. Act as the final consolidator. Gather all "Statistical Insights" from the Analysis Task, the "Image Paths" from the Visualization Task and conversation history.
    2. Synthesize a professional Data Analysis Report in Markdown format.
    3. **Embed Images:** Use the relative paths provided (e.g., `![Trend](images/plot.png)`).
    4. **User Alignment:** Ensure the tone and content directly answer: "{user_query}".
    5. Save the final report file as `{dataset_name}.md` in `{result_path}/{dataset_name}/`.
  expected_output: >
    A final, polished Markdown report saved to disk, which incorporates all analysis and visualizations. 
    The output should confirm the absolute path of the saved report.